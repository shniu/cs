---
description: IO 是什么
---

# IO

IO 是输入输出系统，它直接对应于现实中的输入和输出设备，比如非常早期的开关输入和灯泡输出、到后来的鼠标键盘与显示器、以及到现在智能手机的触摸屏和手机屏幕，这些连接了人和计算机，通过输入我们向计算机下达指令，通过输出我们从计算机获得想要的结果，可见这个输入输出系统定义了人与计算机的交互，但是现实世界和计算机世界是非常不一样的，输入要做到让计算机理解，输入要做到让人更方便的阅读。

### IO 基础与设计

计算机在早期的主要目标是运算，甚至是早前计算机的唯一目标；但是到了现在，计算机是我们日常生活中的一部分，我们在日常生活中更多的是和计算机做交互，输入输出设备的种类和功能便得越来越多，越来越复杂。

我们知道在冯-诺伊曼的体系中，把计算机分成了核心的 5 个部分：运算器、控制器、存储器、输入和输出，可见 IO 是非常重要的组成部分；用于输入输出的，可以是简单的拨码开关\(这是非常早期的输入输出设备\)、LED 灯，也可以是复杂的打印机、网卡、显示器、键盘鼠标、硬盘、耳机、麦克风、游戏机控制手柄等；同时，这些设备在传输速率的要求上也比较大，有高速的显示器，有低速的键盘数笔；既有并行接口也有串行接口；既有使用数字电路的也有使用模拟电路的；所以，输入输出设备有如此大的差异，是没有办法直接和 CPU 芯片直接连接的，因为 CPU 本身已经是一个非常复杂的组件了，不能把和各个 IO 设备的差异也让 CPU 在物理设计上去适配，而我们能做的就是在 CPU 的指令上去统一它们，对于 CPU 来讲，IO 设备都是一样的，没有什么区别，这就在设计上引入了一个中转站：IO 接口，这样输入输出就被分为两部分：IO 接口和实现具体功能的外设。

IO 接口的主要能力：

1. 数据缓冲，用于解决高速的 CPU 和低俗的外设之间的差距
2. 提供联络信息，如打印机什么时候能够接收数据
3. 提供格式上的转换，比如模拟信息和数字信号之间的转换，串行信号和并行信号之间的转换，不同电平之间的转换
4. 一个接口可能连接多个设备，比如多个硬盘，那这个接口还要提供设备选择的能力
5. 中断管理
6. 可编程管理

![IO &#x63A5;&#x53E3;](../../.gitbook/assets/image%20%28102%29.png)

 在计算机系统里面，CPU 和 I/O 设备之间的通信，是这么来解决的。

首先，在 I/O 设备这一侧，我们把 I/O 设备拆分成，能和 CPU 通信的接口电路，以及实际的 I/O 设备本身。接口电路里面有对应的状态寄存器、命令寄存器、数据寄存器、数据缓冲区和设备内存等等。接口电路通过总线和 CPU 通信，接收来自 CPU 的指令和数据。而接口电路中的控制电路，再解码接收到的指令，实际去操作对应的硬件设备。

而在 CPU 这一侧，对 CPU 来说，它看到的并不是一个个特定的设备，而是一个个内存地址或者端口地址。CPU 只是向这些地址传输数据或者读取数据。所需要的指令和操作内存地址的指令其实没有什么本质差别。通过软件层面对于传输的命令数据的定义，而不是提供特殊的新的指令，来实际操作对应的 I/O 硬件。

### IO 接口的编址方式



### IO 控制方式

IO 控制是指主机与外设之间的数据传送控制方式

* 程序控制

其数据传送是在程序的控制下进行的，又分为两种：无条件传送方式和程序查询传送方式。无条件传送方式适合简单外设，如拨码开关和数码管；

程序查询传送方式，需要先编写一段程序，用来查询外设的工作状态，在确定外设已经准备就绪的时候，才进行数据的传送；此外应该 有两根信号线来标明发送方和接收方是否已经准备好。 对于输入设备和输出设备都是如此。 那这对用于交互联络的信号，就叫做握手信号。 在数据传输的每一步，都需要通过握手信号进行确认，然后才可以进行下一步的传输。

数据输出程序查询方式的过程：

1. CPU 执行指令，将控制字写入接口的 控制寄存器，从而设置接口的工作模式
2. CPU 执行指令，将数据写到接口的 输出缓冲寄存器
3. 接口将数据发送到 并行数据输出 信号线上，并将 输出准备好 信号置为有效（也可以又 CPU 写控制字将该信号置为有效）
4. 外设发现 输出准备好 信号有效后，从并行数据输出信号线上接收数据，并将输出回答信号置为有效
5. 接口发现输出回答信号有效后，将状态寄存器中的状态位输出缓冲区置为有效
6. 在这个过程中，CPU 反复执行指令从状态寄存器中读出状态字，直到发现输出缓冲区，然后开始下一个输出过程，继续输出新数据

![&#x6570;&#x636E;&#x8F93;&#x51FA;&#x8FC7;&#x7A0B;&#xFF08;&#x7A0B;&#x5E8F;&#x67E5;&#x8BE2;&#x65B9;&#x5F0F;&#xFF09;](../../.gitbook/assets/image%20%28100%29.png)

数据输入程序查询方式过程：

1. 系统初始化时，CPU 执行指令，将控制字写入接口的控制寄存器，设置接口的工作模式
2. 外设将数据发到并行数据输入信号线上，并将输入准备好信号置为有效
3. 接口发现输入准备好信号有效后，从并行数据输入信号线上接收数据，放入输入缓冲寄存器，并将输入回答置为有效，阻止外设输入新数据
4. 接口将状态寄存器中的状态位输入缓冲满置为有效
5. 在上述过程中，CPU 反复执行指令从状态寄存器中读出状态字，直到发现输入缓冲满，然后执行指令从输入缓冲寄存器中读出数据
6. 接口将输入回答信号置为无效，等待外设输入新数据，当然也会将状态寄存器置为无效等

![&#x6570;&#x636E;&#x8F93;&#x5165;&#x8FC7;&#x7A0B;&#xFF08;&#x7A0B;&#x5E8F;&#x67E5;&#x8BE2;&#x65B9;&#x5F0F;&#xFF09;](../../.gitbook/assets/image%20%2899%29.png)

无条件传送方式，优点是要编写的控制程序非常的简单。 但缺点是只适用于非常简单的外设的操作。 像打印机这种还不算太复杂的设备，就已经不适用了。而程序查询传送方式， 由于有了握手的过程，比无条件传送方式准确和可靠。 但它的缺点是查询外设状态占用了大量的时间。 那这两种方式还有一些共同的特点。 它的优点在于对外设的要求比较低，不需要外设在接口上有很复杂的功能。 而且控制程序的操作流程非常的清晰。 但是缺点在于，要靠CPU进行数据的传送， 如果要传送的数据量很大，除了查询外设状态花的时间 之外，一个一个传送数据也需要花费大量的时间， 占用了CPU非常宝贵的运算资源，从而可能影响这个计算机系统的性能。

![&#x7A0B;&#x5E8F;&#x67E5;&#x8BE2;&#x65B9;&#x5F0F;&#x4F18;&#x7F3A;&#x70B9;](../../.gitbook/assets/image%20%2898%29.png)

* 中断控制

在现在的计算机系统当中， 如果完全依靠CPU进行输入输出，那是有问题的。 比如说我们要通过键盘进行输入，那CPU怎么能保证及时发现键盘的输入呢？ 如果CPU不间断地去查询键盘的输入， 那显然是不合适的，那这样CPU就无法完成其他的任务了。 那如果是间歇地查询呢？先做一段运算的任务，然后查看一下键盘。 那这样也有问题。这个间隔设置为多久合适呢？ 间隔设置的太短，那还是影响CPU执行其他的任务。 间隔设置的太长，又会造成键盘的输入无法得到及时的响应。 所以想要让这个系统正常的工作，我们还得用其他的方法。 这就是我们要介绍的第二种I/O控制方式：中断（也叫外部中断）。

数据输入过程（中断控制方式）：

1. 系统初始化时，CPU 执行指令，将控制字写入接口的控制寄存器，设置接口的工作模式
2. 外设将数据发到并行数据输入信号，并将输入准备好信号置为有效
3. 接口发现输入准备好信号有效后，从并行数据输入信号接收数据，放入输入缓冲寄存器，并将信号置为有效，阻止外设输入新数据
4. 接口通过中断控制逻辑向 CPU 发出中断请求信号，并将状态寄存器中的状态位输入缓冲满置为有效
5. CPU 收到中断请求后，进入中断服务程序，执行指令从状态寄存器中读出状态字，发现输入缓冲满，因此执行指令，从输入缓冲区中读出数据，放入自己的缓冲区中（内存中）
6. 接口将输入回答信号置为无效，等待外设输入新数据；当外设收到输入回答信号无效后，就会继续循环步骤2～6，直到没有数据需要输入

![](../../.gitbook/assets/image%20%28101%29.png)

* 直接存储器访问控制 \(DMA\)



